#!/usr/bin/env bash
set -euo pipefail

set -x

EVENT_STORE=${MONGODB_COLLECTION:-'event_store'}
MONGODB_DB=${MONGODB_DB:-botilka}

docker-compose exec mongodb mongo ${MONGODB_DB} --eval "db.${EVENT_STORE}.drop()"
docker-compose exec mongodb mongo ${MONGODB_DB} --eval "db.createCollection('${EVENT_STORE}')"
docker-compose exec mongodb mongo ${MONGODB_DB} --eval "db.${EVENT_STORE}.createIndex({'uuid': 1, 'playhead': 1}, {'unique': 1})"
